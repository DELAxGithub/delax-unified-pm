# PM統合開発方針書

## 概要

PMLibraryとPMPlattoを段階的に統合し、最終的にDELAxPMという汎用番組制作管理プラットフォームを構築する。本文書は、リスクを最小化しながら確実に統合を成功させるための開発方針を定める。

## 統合戦略

### Phase 1: PMLibraryベースでのPMPlatto統合
- **基本方針**: 稼働中のPMLibraryを基盤として、PMPlattoの機能を統合
- **期間**: 3-4週間
- **ゴール**: 両システムの機能を持つ統合版の完成

### Phase 2: DELAxPMプラットフォーム化
- **基本方針**: 統合システムを汎用化し、新番組の迅速な立ち上げを可能に
- **期間**: 2-3週間
- **ゴール**: 3クリックで新番組環境をセットアップできるプラットフォーム

## 開発環境自動化

### 現状の課題
- Supabaseプロジェクトの手動セットアップが煩雑
- スキーマ、RLS、Edge Functionsの初期設定に時間がかかる
- 新番組立ち上げ時の環境構築が非効率

### 目指すゴール
```bash
# ワンコマンドで環境構築完了
./setup-new-project.sh "新番組名" "pmplatform"
```

### リサーチ項目
1. **既存ツール調査**
   - Supabase CLI活用方法
   - T3 Stack等のボイラープレート
   - Infrastructure as Codeソリューション

2. **PoC実装**
   - CloudKit PoCと同様のアプローチ
   - ガワだけ作成→既存ソリューション調査→最適解選定

## 技術スタック

### 現状
- **フロントエンド**: React, TypeScript, Vite, Tailwind CSS
- **バックエンド**: Supabase (PostgreSQL, Auth, Realtime, Edge Functions)
- **デプロイ**: Netlify
- **バージョン管理**: GitHub

### 統合後の構成（モノレポ）
```
DELAxPM/
├── apps/
│   ├── unified/          # 統合版アプリ
│   ├── pmlibrary/        # 既存PMLibrary（移行期間中）
│   └── pmplatto/         # 既存PMPlatto（移行期間中）
├── packages/
│   ├── shared-ui/        # 共通UIコンポーネント
│   ├── shared-types/     # TypeScript型定義
│   └── supabase-client/  # Supabase接続共通化
├── supabase/
│   ├── migrations/       # 統合スキーマ移行
│   └── functions/        # Edge Functions
└── deploy/
    ├── netlify-unified/  # 統合版デプロイ設定
    └── netlify-legacy/   # 既存版デプロイ設定
```

## 実装手順

### Week 1: 現状分析・設計
1. **Day 1-2**: 差分分析
   - 両システムのデータベーススキーマ比較
   - 機能差分の洗い出し
   - UI/UXパターンの整理

2. **Day 3-4**: 統合設計
   - 統合スキーマ設計
   - データ移行計画策定
   - モノレポ構造設計

3. **Day 5**: 環境自動化調査
   - 既存ツールのリサーチ
   - PoC方針決定

### Week 2: 基盤実装
1. **モノレポ環境構築**
   - Turborepo/Nx等の導入検討
   - 共通パッケージの切り出し
   - CI/CDパイプライン整備

2. **データベース統合準備**
   - 移行スクリプト作成
   - テスト環境での検証
   - ロールバック手順確立

### Week 3: 機能統合
1. **PMPlatto固有機能の移植**
   - PR納品管理機能
   - その他の差分機能

2. **統合テスト**
   - E2Eテスト作成
   - ユーザーワークフロー検証

### Week 4: 本番移行
1. **ステージング環境デプロイ**
2. **本番データ移行リハーサル**
3. **段階的本番切り替え**

## リスク管理

### Blue-Greenデプロイメント
- 既存環境を維持したまま新環境を構築
- DNS切り替えによる無停止移行
- 問題発生時の即座ロールバック

### データ保護
- 移行前の完全バックアップ
- 段階的データ移行
- リアルタイム同期期間の設定

### 失敗防止チェックリスト
- [ ] PMPlatto全機能のスクリーンショット保存
- [ ] 既存ユーザーワークフローの文書化
- [ ] Supabaseデータの完全バックアップ
- [ ] ロールバック手順の事前テスト
- [ ] ステージング環境での十分な動作確認

## 成功指標

### 技術指標
- データ移行時の損失: 0件
- システム停止時間: 0分
- パフォーマンス劣化: なし

### ビジネス指標
- 新番組セットアップ時間: 3分以内
- 既存ユーザーの満足度維持
- 開発効率の向上（具体的な数値は統合後測定）

## 次のアクション

1. **即座に開始**
   - 両リポジトリのクローンと差分分析
   - 開発環境自動化ツールのリサーチ開始

2. **今週中に完了**
   - 統合設計書の作成
   - PoC環境の構築

3. **継続的に実施**
   - 週次進捗レビュー
   - リスク評価と対策の更新

---

